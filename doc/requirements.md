# シンプルパズル - 要件定義書

## プロジェクト概要
スライド式の数字並べ替えパズルゲーム（15パズル系）。AI機能によるヒント・最適解表示・プレイスタイル分析を搭載。

## 目的・課題
- **目的**: 論理的思考力と問題解決能力を楽しく鍛える
- **課題**: パズルが難しすぎて諦めてしまう、自分の弱点が分からない
- **解決策**: AI によるヒント機能と詳細な分析で、誰でも楽しめるパズル体験を提供

## ターゲットユーザー
- パズルゲーム初心者から上級者まで
- 論理的思考を鍛えたい人
- 暇つぶしに軽く遊びたい人

---

## 機能要件

### 1. パズル機能

#### 1.1 パズルタイプ
- **スライド式数字並べ替えパズル**（15パズル系）
- 数字タイルをスライドさせて、順番に並べる
- 1つの空きマスを利用してタイルを移動

#### 1.2 パズルサイズ（難易度別）
- **初級**: 4×4（15パズル）
- **中級**: 5×5（24パズル）
- **上級**: 9×9（80パズル）
- **カスタムサイズ**: 10×10、11×11 等（可能な範囲で実装）

#### 1.3 表示モード
- **数字モード**: タイルに数字を表示（1, 2, 3...）
- **画像モード**: タイルに画像の一部を表示（画像パズル）
  - ユーザーが画像をアップロード可能
  - プリセット画像も用意

#### 1.4 シャッフル機能
- **シャッフル回数**: 固定（難易度に応じて自動設定）
- **設定画面**: スライダーでシャッフル回数を手動調整可能
- 解けない配置にならないようにアルゴリズムで保証

### 2. ゲームモード（3種類）

#### 2.1 タイムアタックモード
- **制限時間内にパズルを完成させる**
- 制限時間: 難易度に応じて設定（初級: 5分、中級: 10分、上級: 20分）
- タイムアップでゲームオーバー
- クリア時に経過時間を記録

#### 2.2 手数最小チャレンジモード
- **最小手数でパズルを完成させる**
- 制限手数なし、手数をカウント
- クリア後に「最適解との差」を表示
- 手数ランキング機能

#### 2.3 フリープレイモード
- **時間・手数制限なし**
- 自由に練習できるモード
- リラックスして遊べる

### 3. AI機能（必須要件）

#### 3.1 解法ヒント生成
- **機能**: 次の最適な一手をAIが提案
- **実装**: OpenAI API または Google Gemini API を使用
- **表示内容**:
  - 「左上のタイル（3）を下に移動してください」
  - ヒントを使うと手数にペナルティ（+3手等）
- **制限**: 1ゲームにつき3回まで（設定で変更可能）

#### 3.2 最適解の手順表示
- **機能**: パズルの最適解（最短手数）をステップバイステップで表示
- **実装**: A*アルゴリズム + AI による解説生成
- **表示内容**:
  - 「1. タイル5を右に移動」
  - 「2. タイル8を下に移動」
  - 各ステップの理由を AI が解説
- **使用時の効果**: 手数カウント停止、記録には残らない（練習用）

#### 3.3 プレイスタイル分析
- **機能**: プレイ後に AI がプレイスタイルを分析
- **分析項目**:
  - 平均手数 vs 最適解
  - よく使う移動パターン
  - 苦手な配置パターン
  - 改善ポイント
- **アドバイス例**:
  - 「角のタイルから先に揃える癖があります。中央から攻めると効率的です」
  - 「焦らず落ち着いてプレイすると、手数が20%削減できそうです」

### 4. 統計・記録機能

#### 4.1 リアルタイム表示
- 経過時間（MM:SS）
- 手数カウント
- 難易度表示

#### 4.2 プレイ履歴
- 過去のスコア一覧
- クリアタイム・手数の推移グラフ
- ベストスコア表示（難易度別）

#### 4.3 週間記録
- 今週のプレイ回数
- 今週のベストタイム
- 週間ランキング

### 5. PWA 対応（必須要件）

#### 5.1 オフライン対応
- **Service Worker**: 完全オフライン動作
- **オフライン機能**:
  - パズル生成・プレイ
  - スコア記録（IndexedDB）
  - AIヒント（事前キャッシュ済みヒント使用）
  - 最適解計算（ローカルアルゴリズム）

#### 5.2 インストール可能
- **Manifest.json**: アプリアイコン、名前、テーマカラー設定
- **スタンドアロンモード**: ブラウザUIなしで起動

---

## 技術制約

### 必須技術スタック
- **フロントエンド**: Next.js 14.x / React 18.x
- **スタイリング**: Tailwind CSS v3
- **PWA**: Service Worker、Manifest.json
- **AI API**: OpenAI API または Google Gemini API
- **データ保存**: IndexedDB（ローカルストレージ）
- **パズルアルゴリズム**: A*アルゴリズム（最適解計算）

### API要件
- **AI API キー**: 環境変数で管理（`.env.local`）
- **オフライン対応**: ローカルアルゴリズムで最適解計算も可能に

---

## 環境要件
- **開発環境**: WSL2 Ubuntu + Windows
- **ブラウザ**: Chrome、Firefox、Safari（最新版）
- **レスポンシブ**: デスクトップ、タブレット、スマートフォン対応

---

## デザイン要求

### UI参考デザイン
**重要**: 実装時は以下のUIイメージを参考にしてください。

**参考画像**: `png/ui-reference.png`

**デザイン仕様（参考画像に基づく）**:
- **背景**: ダークブルー〜パープルのグラデーション（#1e3a8a → #6b21a8）
- **レイアウト構成**:
  - **左上**: タイトル「スライドパズル」
  - **モード選択タブ**: タイムアタック、今週の記録等
  - **統計バー**: 経過時間、手数、難易度を横並びで表示
  - **中央メイン**: パズルボード（6×6グリッド）
  - **右サイド**: AI機能ボタン（ヒント、最適解、プレイスタイル分析）
  - **下部**: 難易度選択（初級、中級、上級）、PWAバッジ
- **パズルボード**:
  - タイル: 白〜薄いブルーのグラデーション、影付き
  - 数字: ダークネイビー（#1e3a8a）、大きく太字
  - 空きマス: 濃いグレー（#374151）
  - タイル間の隙間: 細い線
  - ホバー時: タイルが微細に浮き上がる
- **AIボタン**:
  - 発光する黄色/オレンジ系（#f59e0b）
  - アイコン付き（電球、地図、グラフ）
  - クリック時にアニメーション
- **カラースキーム**:
  - メイン: ブルー〜パープル系
  - アクセント: イエロー/オレンジ（AIボタン）
  - タイル: 白〜薄いブルー
  - 文字: ダークネイビー

**UI/UX要求**:
- **直感的操作**: タップ/クリックでタイル移動
- **スムーズなアニメーション**: タイル移動時のトランジション
- **視覚的フィードバック**: 移動可能なタイルをハイライト

**実装時の注意事項**:
- このデザインを**ベース**として、要件に合わせて調整
- タイルの立体感を表現（シャドウ、グラデーション）
- レスポンシブ対応時も見やすさを維持
- パズルサイズが大きくなっても見やすいスケーリング

---

## 成功基準

### 機能面
- ✅ パズルが正しく動作（4×4、5×5、9×9）
- ✅ AI ヒント・最適解が正確
- ✅ オフラインで完全動作

### パフォーマンス
- ✅ タイル移動のアニメーション < 300ms
- ✅ AI API レスポンス < 3秒
- ✅ 最適解計算（A*） < 5秒（9×9以下）
- ✅ Lighthouse スコア 90点以上

### ユーザビリティ
- ✅ 初回訪問から1分以内にプレイ開始可能
- ✅ AI分析レポートが分かりやすい
- ✅ タイル操作が直感的

---

## スケジュール
- **要件定義**: 作成中
- **技術設計**: 次フェーズ
- **実装計画**: TDD準拠で作成
- **実装**: 後日（実装計画書完成後）

---

## 備考
- 既存アプリとの流用: なし（新規タイプ）
- 将来的な拡張: マルチプレイヤー対戦、画像カスタマイズ機能強化
